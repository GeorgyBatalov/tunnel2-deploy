# ===================================================================
# Tunnel2 Server - Production Environment
# ===================================================================
# IMPORTANT: This file contains PRODUCTION configuration
# Secrets must be loaded from vault.env or environment
# ===================================================================

# ===== Vault Configuration =====
# Vault address and token MUST be set in vault.env (not in this file!)
# vault.env is not committed to git
TUNNEL_Vault__Address=http://tunnel2_vault:8300
TUNNEL_Vault__BasePath=tunnel/tunnel-server
TUNNEL_Vault__MountPoint=secret
# TUNNEL_Vault__Token=<SET IN vault.env - NEVER COMMIT>

# ===== Proxy Entries Configuration =====
# List of ProxyEntry instances that clients can connect to
TUNNEL_ProxyEntries__Entries__0=e1

# ===== Public Domain Configuration =====
# CRITICAL: This must match your wildcard DNS setup and SSL certificate
TunnelServer__PublicDomainUri=https://tunnel4.com

# ===== TLS Certificate Configuration =====
TunnelServer__AllowTls13=true

# ===== Database Configuration =====
# PostgreSQL connection string (password loaded from Vault or vault.env)
# Format: Host=postgres;Port=5432;Database=tunnel2;Username=tunnel2_user;Password=<from-vault>
TUNNEL_ConnectionStrings__PostgreSQL=Host=postgres;Port=5432;Database=tunnel2;Username=tunnel2_user;Password=${POSTGRES_PASSWORD}

# ===== Redis Configuration =====
TUNNEL_Redis__ConnectionString=tunnel2_redis:6379,abortConnect=false

# ===== RabbitMQ Configuration =====
# RabbitMQ configuration (using existing chefbot_rabbitmq container)
# Password must be set in vault.env
Rabbit__HostName=chefbot_rabbitmq
Rabbit__Port=5672
Rabbit__UserName=tunnel2_rabbitmq
Rabbit__VirtualHost=/tunnel2
# Rabbit__Password=<SET IN vault.env - NEVER COMMIT>

# TUNNEL_ prefixed versions (higher priority, bypass Vault for critical settings)
TUNNEL_Rabbit__HostName=chefbot_rabbitmq
TUNNEL_Rabbit__Port=5672
TUNNEL_Rabbit__UserName=tunnel2_rabbitmq
TUNNEL_Rabbit__VirtualHost=/tunnel2
TUNNEL_Rabbit__Password=${RABBITMQ_PASSWORD}

# ===== Security & Feature Flags =====
# CRITICAL: MUST be false or omitted in production!
# TunnelServer__AllowDevSessionId=false  # NEVER set to true in production!

# ===== Performance Tuning =====
# Kestrel limits for high load
Kestrel__Limits__MaxConcurrentConnections=5000
Kestrel__Limits__MaxConcurrentUpgradedConnections=5000
Kestrel__Limits__KeepAliveTimeout=00:02:00
Kestrel__Limits__RequestHeadersTimeout=00:00:30

# ===== Logging Configuration =====
Serilog__MinimumLevel__Default=Information
Serilog__MinimumLevel__Override__Microsoft=Warning
Serilog__MinimumLevel__Override__System=Warning

# ===== ASP.NET Core Environment =====
ASPNETCORE_ENVIRONMENT=Production

# ===== Tier Plans - Disable Session Limits (Phase 7) =====
# SessionMaxHours and DailySessionHours: 0 = unlimited
# Override tier-plans.json via environment variables (highest priority)
TUNNEL_TierPlans__Guest__SessionMaxHours=0
TUNNEL_TierPlans__Guest__DailySessionHours=0
TUNNEL_TierPlans__Guest__TcpEnabled=true

TUNNEL_TierPlans__Free__SessionMaxHours=0
TUNNEL_TierPlans__Free__DailySessionHours=0
TUNNEL_TierPlans__Free__TcpEnabled=true

TUNNEL_TierPlans__Personal__SessionMaxHours=0
TUNNEL_TierPlans__Personal__DailySessionHours=0

TUNNEL_TierPlans__Professional__SessionMaxHours=0
TUNNEL_TierPlans__Professional__DailySessionHours=0

TUNNEL_TierPlans__Business__SessionMaxHours=0
TUNNEL_TierPlans__Business__DailySessionHours=0

# ===== OpenTelemetry / Distributed Tracing (Phase 8) =====
# Loaded from Vault (OpenTelemetry/Enabled, OpenTelemetry/OtlpEndpoint)
