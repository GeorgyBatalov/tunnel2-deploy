# ===================================================================
# Tunnel2 Server - Production Environment
# ===================================================================
# IMPORTANT: This file contains PRODUCTION configuration
# Secrets are loaded from Vault at runtime
# ===================================================================

# ===== Vault Configuration =====
# Vault address (internal docker network)
Vault__Address=http://vault:8200

# Vault token (SET THIS FROM .env FILE AFTER VAULT INITIALIZATION)
# DO NOT hardcode production token here!
Vault__Token=${VAULT_ROOT_TOKEN}

# ===== Proxy Entries Configuration =====
# List of ProxyEntry instances that clients can connect to
# Format: ProxyEntries__Entries__0=e1, ProxyEntries__Entries__1=e2, etc.
ProxyEntries__Entries__0=e1

# ===== Public Domain Configuration =====
# CRITICAL: This must match your wildcard DNS setup
# Format: https://{sessionId}-{proxyEntryId}.tunnel2.xtunnel.ru
TunnelServer__PublicDomainUri=https://tunnel2.xtunnel.ru

# ===== Database Configuration =====
# PostgreSQL connection string (docker network service name: postgres)
ConnectionStrings__PostgreSQL=Host=postgres;Port=5432;Database=tunnel2;Username=${POSTGRES_USER};Password=${POSTGRES_PASSWORD}

# ===== Redis Configuration =====
# Redis connection string (loaded from Vault, but can be overridden here for testing)
# Redis__ConnectionString=redis:6379

# ===== RabbitMQ Configuration =====
# RabbitMQ configuration (loaded from Vault, but can be overridden here)
# Rabbit__HostName=rabbitmq
# Rabbit__Port=5672
# Rabbit__UserName=${RABBITMQ_USER}
# Rabbit__Password=${RABBITMQ_PASSWORD}
# Rabbit__VirtualHost=/tunnel2

# ===== Security & Feature Flags =====
# CRITICAL: MUST be false or omitted in production!
# DevSessionId feature allows clients to specify custom session IDs (INSECURE!)
# TunnelServer__AllowDevSessionId=false  # NEVER set to true in production!
# TUNNEL_SERVER_IS_TEST_ENV=false         # NEVER set to true in production!

# ===== Performance Tuning =====
# Kestrel limits for high load (adjust based on expected traffic)
Kestrel__Limits__MaxConcurrentConnections=5000
Kestrel__Limits__MaxConcurrentUpgradedConnections=5000
Kestrel__Limits__KeepAliveTimeout=00:02:00
Kestrel__Limits__RequestHeadersTimeout=00:00:30

# ===== Logging Configuration =====
# Serilog minimum level (Information for production, Debug for troubleshooting)
Serilog__MinimumLevel__Default=Information
Serilog__MinimumLevel__Override__Microsoft=Warning
Serilog__MinimumLevel__Override__System=Warning

# ===== ASP.NET Core Environment =====
ASPNETCORE_ENVIRONMENT=Production
