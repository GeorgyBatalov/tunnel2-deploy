[SERVICE]
    Flush        5
    Daemon       Off
    Log_Level    info
    Parsers_File parsers.conf

# Collect logs from Docker containers
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*.log
    Parser            docker
    Tag               docker.*
    Refresh_Interval  5
    Mem_Buf_Limit     5MB
    Skip_Long_Lines   On
    Exclude_Path      /var/lib/docker/containers/*fluentbit*/*.log

# Parse JSON logs from .NET applications
[FILTER]
    Name                parser
    Match               docker.*
    Key_Name            log
    Parser              dotnet-json
    Reserve_Data        On
    Preserve_Key        On

# Enrich with service names based on container names
[FILTER]
    Name                modify
    Match               docker.*
    Add                 cluster tunnel2
    Add                 environment dev

# Filter out health check noise if needed
# [FILTER]
#     Name                grep
#     Match               docker.*
#     Exclude             log health

# Send to OpenSearch
[OUTPUT]
    Name                opensearch
    Match               docker.*
    Host                opensearch
    Port                9200
    Index               tunnel2-logs
    Type                _doc
    Suppress_Type_Name  On
    Retry_Limit         False
    Generate_ID         On
    Logstash_Format     On
    Logstash_Prefix     tunnel2-logs

# Debug output (optional - comment out in production)
[OUTPUT]
    Name            stdout
    Match           docker.*
    Format          json_lines
