# Tunnel2 Deploy - Development Environment

**‚ö†Ô∏è DEVELOPMENT ONLY REPOSITORY - DO NOT USE IN PRODUCTION!**

This repository contains **local development** deployment configuration for Tunnel2 project.

**For production deployment use:** [tunnel2-deploy-prod](https://github.com/GeorgyBatalov/tunnel2-deploy-prod)

## Purpose
–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ Tunnel2 —á–µ—Ä–µ–∑ docker-compose.

## Structure
- `docker-compose-infrastructure.yml` ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (Vault, Redis, RabbitMQ, PostgreSQL, DNS Server, OpenSearch, Fluent Bit)
- `docker-compose.yml` ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Tunnel2 (server, proxy-entry) –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –±—ç–∫–µ–Ω–¥—ã
- `env/` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
- `vault/` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vault –¥–ª—è dev —Å—Ä–µ–¥—ã
- `scripts/` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è
  - `start-all.sh` ‚Äî –ø–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π (–∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–µ—Ç Vault)
  - `stop-all.sh` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  - `vault-unseal.sh` ‚Äî —Ä–∞—Å–ø–µ—á–∞—Ç–∫–∞ Vault
- `grafana/`, `prometheus/`, `fluentbit/`, `otel-collector/` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `.github_token` ‚Äî GitHub Personal Access Token –¥–ª—è NuGet –ø–∞–∫–µ—Ç–æ–≤ (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
- `vault-keys.json` ‚Äî –∫–ª—é—á–∏ –¥–ª—è —Ä–∞—Å–ø–µ—á–∞—Ç–∫–∏ Vault (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)

## Quick Start (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±) üöÄ

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```bash
cd tunnel2-deploy
./scripts/start-all.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
2. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (Vault, Redis, RabbitMQ, PostgreSQL, DNS Server)
3. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–µ—Ç Vault** –∏—Å–ø–æ–ª—å–∑—É—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∫–ª—é—á–∏
4. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Tunnel2 (TunnelServer, ProxyEntry)
5. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –±—ç–∫–µ–Ω–¥—ã (Test Backend, Httpbin)
6. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ endpoints

–ü–æ–ª–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
./scripts/stop-all.sh
```

## Manual Deployment (–ü–æ—à–∞–≥–æ–≤—ã–π —Å–ø–æ—Å–æ–±)

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º:

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
cd dev
docker compose -f docker-compose-infrastructure.yml up -d
```

–ó–∞–ø—É—Å–∫–∞–µ—Ç:
- Vault (–ø–æ—Ä—Ç 8200)
- Redis (–ø–æ—Ä—Ç 6379)
- RabbitMQ (–ø–æ—Ä—Ç—ã 5672, 15672)
- PostgreSQL (–ø–æ—Ä—Ç 12010)
- DNS Server (–ø–æ—Ä—Ç 12053)

### 2. –†–∞—Å–ø–µ—á–∞—Ç–∫–∞ Vault

```bash
cd ..
./scripts/vault-unseal.sh
```

Vault –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–µ—á–∞—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑—É—è –∫–ª—é—á–∏ –∏–∑ `vault-keys.json`.

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

```bash
cd dev
docker compose -f docker-compose.yml up -d --build
```

–ó–∞–ø—É—Å–∫–∞–µ—Ç:
- TunnelServer (Control Plane, –ø–æ—Ä—Ç 12002)
- ProxyEntry (Data Plane, –ø–æ—Ä—Ç—ã 12000, 12001)
- Test Backend (–ø–æ—Ä—Ç 12007)
- Httpbin (–ø–æ—Ä—Ç 12005)

## Advanced Operations

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

```bash
cd dev
docker compose -f docker-compose.yml up -d --build tunnel_server
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker logs tunnel2-tunnel_server-1 -f
docker logs tunnel2-tunnel_entry-1 -f
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏

```bash
cd dev
docker compose -f docker-compose.yml restart tunnel_server
```

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (—É–¥–∞–ª–µ–Ω–∏–µ volumes)

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–∞—è Vault!

```bash
cd dev
docker compose -f docker-compose.yml down
docker compose -f docker-compose-infrastructure.yml down
docker volume rm tunnel2_vault-data tunnel2_postgres-data
```

## Available Endpoints

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã:

| Service | URL | Description |
|---------|-----|-------------|
| **Vault UI** | http://localhost:8200 | HashiCorp Vault UI (root token –≤ `vault-keys.json`) |
| **RabbitMQ UI** | http://localhost:15672 | RabbitMQ Management (guest/guest) |
| **ProxyEntry HTTP** | http://localhost:12000 | Data Plane - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Ç—É–Ω–Ω–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ |
| **ProxyEntry Uplink** | http://localhost:12001 | Data Plane - uplink –ø–æ—Ä—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ |
| **TunnelServer** | http://localhost:12002 | Control Plane - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ |
| **Test Backend** | http://localhost:12007 | –¢–µ—Å—Ç–æ–≤—ã–π –±—ç–∫–µ–Ω–¥ —Å custom endpoints |
| **Httpbin** | http://localhost:12005 | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π httpbin –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| **DNS Server** | udp://localhost:12053 | DNS —Å–µ—Ä–≤–µ—Ä –¥–ª—è –¥–æ–º–µ–Ω–Ω—ã—Ö –∏–º—ë–Ω —Ç—É–Ω–Ω–µ–ª–µ–π |
| **Redis** | localhost:6379 | Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è |
| **PostgreSQL** | localhost:12010 | PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |

## Configuration

### Secrets Management

–°–µ–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ `tunnel2-deploy/` –∏ **–Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è –≤ git**:

- `.github_token` ‚Äî GitHub Personal Access Token –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º NuGet –ø–∞–∫–µ—Ç–∞–º
- `vault-keys.json` ‚Äî –ö–ª—é—á–∏ —Ä–∞—Å–ø–µ—á–∞—Ç–∫–∏ Vault –∏ root token

**–ó–∞—â–∏—Ç–∞:** –≠—Ç–∏ —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.gitignore` –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

### Environment Variables

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `dev/env/`:

- `tunnel_server.env` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è TunnelServer (Control Plane)
- `tunnel_entry.env` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è ProxyEntry (Data Plane)
- `dns_server.env` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è DNS Server

### Vault Integration

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç HashiCorp Vault –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (RSA –∫–ª—é—á–∏, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã):

```env
Vault__Address=http://vault:8200
Vault__Token=<your-vault-root-token>  # –ò–∑ vault-keys.json
```

**–í–∞–∂–Ω–æ:** Root token –±–µ—Ä—ë—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞ `vault-keys.json` –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

Vault –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º `vault-unseal.sh`.

### Dev Features

#### AllowDevSessionId

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ TunnelServer –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ SessionId:

```env
# tunnel_server.env
TunnelServer__AllowDevSessionId=true
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç:**
- –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç —É–∫–∞–∑–∞—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SessionId —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `--dev-session-id`
- URL —Ç—É–Ω–Ω–µ–ª—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º: `http://{session-id}-e1.tunnel.local:12000`
- –£–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –≠—Ç–æ—Ç —Ñ–ª–∞–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `true` —Ç–æ–ª—å–∫–æ –≤ dev/test –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
- –í Production —Å—Ä–µ–¥–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `AllowDevSessionId=false` –∏–ª–∏ –Ω–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ —ç—Ç—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```bash
# –ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º SessionId
dotnet run --project tunnel2-client/src/Tunnel.ClientApp -- \
  --dev-session-id=a1b2c3d4-e5f6-4a5b-8c9d-0e1f2a3b4c5d \
  --backend-host=localhost \
  --backend-port=12005

# –¢–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:
# http://a1b2c3d4-e5f6-4a5b-8c9d-0e1f2a3b4c5d-e1.tunnel.local:12000
```


## ‚öôÔ∏è Port Convention

–î–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –æ—Ç–ª–∞–¥–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è —Å—Ö–µ–º–∞ –ø–æ—Ä—Ç–æ–≤:

| Environment | Purpose | Port Range | Example |
|--------------|----------|-------------|----------|
| **Docker** | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `tunnel2-deploy/docker-compose-localhost.yml` | `12000‚Äì12099` | `12000` ‚Äì ProxyEntry (HTTP)<br>`12001` ‚Äì ProxyEntry (uplink)<br>`12002` ‚Äì TunnelServer |
| **Localhost (Debug)** | –õ–æ–∫–∞–ª—å–Ω–æ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –≤ IDE (–Ω–∞–ø—Ä–∏–º–µ—Ä, Rider, VSCode) | `13000‚Äì13099` | `13000` ‚Äì ProxyEntry (HTTP)<br>`13001` ‚Äì ProxyEntry (uplink)<br>`13002` ‚Äì TunnelServer |
| **External Services** | –°—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (Vault, Redis, RabbitMQ, httpbin –∏ —Ç. –¥.) | –∏—Ö ‚Äú—Ä–æ–¥–Ω—ã–µ‚Äù –ø–æ—Ä—Ç—ã | `8200` ‚Äì Vault<br>`6379` ‚Äì Redis<br>`5672` ‚Äì RabbitMQ<br>`8080` ‚Äì TestBackend |

### –ü—Ä–∞–≤–∏–ª–æ:
- –ü–æ—Ä—Ç—ã `12xxx` –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker (production/dev/test –æ–∫—Ä—É–∂–µ–Ω–∏—è).
- –ü–æ—Ä—Ç—ã `13xxx` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ –º–æ–∂–Ω–æ –±—ã–ª–æ –ª–µ–≥–∫–æ —Ä–∞–∑–ª–∏—á–∞—Ç—å, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω —Å–µ—Ä–≤–∏—Å.
- –°—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–≤–æ–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ (—Ä–æ–¥–Ω—ã–µ) –ø–æ—Ä—Ç—ã.

## Architecture & Design Decisions

### Split Docker Compose Files

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö compose —Ñ–∞–π–ª–∞** –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ:

#### `docker-compose-infrastructure.yml` - Infrastructure Layer
- Vault, Redis, RabbitMQ, PostgreSQL, DNS Server
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑, —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
- –†–µ–¥–∫–æ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

#### `docker-compose.yml` - Application Layer
- TunnelServer, ProxyEntry, Test Backend, Httpbin
- –ß–∞—Å—Ç–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç infrastructure layer

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –ë—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç—Å—è)
- üîí Vault –æ—Å—Ç–∞—ë—Ç—Å—è unsealed –º–µ–∂–¥—É –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞–º–∏
- üéØ –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- üíæ –î–∞–Ω–Ω—ã–µ (Vault, PostgreSQL) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Docker volumes

### Unified Network

–û–±–∞ compose —Ñ–∞–π–ª–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–µ–¥–∏–Ω—É—é —Å–µ—Ç—å** `tunnel2-network`:

```yaml
networks:
  default:
    name: tunnel2-network
    external: true
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- TunnelServer –∏ ProxyEntry –≤–∏–¥–µ—Ç—å Vault –ø–æ –∏–º–µ–Ω–∏ `vault`
- –í—Å–µ–º —Å–µ—Ä–≤–∏—Å–∞–º –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–º–∏ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –£–ø—Ä–æ—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –æ—Ç–ª–∞–¥–∫—É

### Container Management Strategy

–°–∫—Ä–∏–ø—Ç `start-all.sh` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—É–º–Ω—ã–π –ø–æ–¥—Ö–æ–¥** –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏:

1. **–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** (`docker compose down`)
2. **Docker Compose —Å–∞–º —Ä–µ—à–∞–µ—Ç** —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏:
   - –ï—Å–ª–∏ –æ–±—Ä–∞–∑ –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   - –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É–∂–µ –∑–∞–ø—É—â–µ–Ω ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
   - –ï—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. **Volumes —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** - –¥–∞–Ω–Ω—ã–µ Vault –∏ PostgreSQL –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (volumes –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è)
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è

### Vault Auto-Unseal

Vault **–ù–ï —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:
- –°–∫—Ä–∏–ø—Ç `vault-unseal.sh` —á–∏—Ç–∞–µ—Ç –∫–ª—é—á–∏ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ `vault-keys.json`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç 3 –∏–∑ 5 –∫–ª—é—á–µ–π
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ —Å–æ–æ–±—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å

–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ:
- üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ (–∫–ª—é—á–∏ –Ω–µ –≤ environment variables)
- üöÄ –£–¥–æ–±–Ω–æ (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç)
- üìã Production-ready (–º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è prod —Å –¥—Ä—É–≥–∏–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏)